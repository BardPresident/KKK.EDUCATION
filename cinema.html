<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíÄ THE TOMB CINEMA üíÄ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        /* ‚îÄ‚îÄ DARK MODE (default) ‚îÄ‚îÄ */
        body {
            background: #0a0a0a;
            color: #d4af37;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
            overflow-x: hidden;
            transition: background 0.4s, color 0.4s;
        }

        /* ‚îÄ‚îÄ LIGHT MODE ‚îÄ‚îÄ */
        body.light {
            background: #f5f0e8;
            color: #5a3e1b;
        }
        body.light .header {
            background: rgba(212,175,55,0.12);
            border-color: #8b6914;
            box-shadow: 0 0 40px rgba(139,105,20,0.2);
        }
        body.light .header h1 { text-shadow: 0 0 20px rgba(139,105,20,0.5); color: #5a3e1b; }
        body.light .header .subtitle { color: #3a2a0a; }
        body.light .stats { background: rgba(212,175,55,0.15); border-color: #8b6914; }
        body.light .breadcrumb { background: rgba(212,175,55,0.15); border-color: #8b6914; }
        body.light .breadcrumb-item { color: #5a3e1b; }
        body.light .breadcrumb-item:hover { background: rgba(139,105,20,0.2); }
        body.light .file-manager { background: rgba(255,248,235,0.9); border-color: #8b6914; }
        body.light .file-item { background: rgba(212,175,55,0.1); border-color: #8b6914; }
        body.light .file-item:hover { background: rgba(212,175,55,0.3); box-shadow: 0 10px 30px rgba(139,105,20,0.3); }
        body.light .action-btn { background: rgba(212,175,55,0.2); border-color: #8b6914; color: #5a3e1b; }
        body.light .action-btn:hover { background: rgba(212,175,55,0.4); }
        body.light .modal-content { background: #fffaf2; border-color: #8b6914; box-shadow: 0 0 60px rgba(139,105,20,0.4); }
        body.light .modal-header { border-color: #8b6914; }
        body.light .close-btn { color: #5a3e1b; }
        body.light .preview-text { background: #fffaf2; color: #3a2a0a; }
        body.light .download-btn { background: rgba(212,175,55,0.2); border-color: #8b6914; color: #5a3e1b; }
        body.light .download-btn:hover { background: rgba(212,175,55,0.4); }
        body.light .instructions { background: rgba(212,175,55,0.08); border-color: #8b6914; }
        body.light .instructions h2 { color: #5a3e1b; }
        body.light .instructions h3 { color: #7a5520; }
        body.light .instructions p,
        body.light .instructions li { color: #5a3e1b; }
        body.light .instructions code { background: rgba(139,105,20,0.12); color: #2a6000; }
        body.light .instructions pre { background: #fffaf2; border-color: #8b6914; }
        body.light .instructions .highlight { background: rgba(212,175,55,0.2); border-color: #8b6914; }
        body.light .instructions .highlight p { color: #3a2a0a; }
        body.light .back-home { border-color: rgba(90,62,27,0.5); color: #5a3e1b; }
        body.light .back-home:hover { background: rgba(90,62,27,0.1); color: #7a5520; border-color: #7a5520; }
        body.light .quotes-container { color: #8b6914; }
        body.light ::-webkit-scrollbar-track { background: #f5f0e8; }
        body.light ::-webkit-scrollbar-thumb { background: #8b6914; }
        body.light #modal { background: rgba(245,240,232,0.98); }
        body.light .stat-value { color: #3a2a0a; }
        body.light .stat-label { color: #5a3e1b; }
        body.light .file-name { color: #3a2a0a; }
        body.light .file-size { color: #7a5520; }
        body.light .file-icon { filter: none; }
        body.light .header .tagline { color: #5a3e1b; }
        body.light .instructions strong { color: #3a2a0a; }
        body.light .state-message { color: #3a2a0a; }
        body.light .modal-title { color: #3a2a0a; }
        body.light a { color: #5a3e1b; }
        body.light a:hover { color: #3a2a0a; }
        .instructions a { color: #ffd700; }
        .instructions a:hover { color: #fff; }
        body.light .instructions a { color: #7a5520; }
        body.light .instructions a:hover { color: #3a2a0a; }

        /* ‚îÄ‚îÄ MODE TOGGLE BUTTON ‚îÄ‚îÄ */
        #modeToggle {
            position: fixed;
            top: 14px;
            right: 16px;
            z-index: 9000;
            padding: 8px 16px;
            background: rgba(212,175,55,0.15);
            border: 2px solid #d4af37;
            color: #d4af37;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            cursor: pointer;
            border-radius: 20px;
            transition: all 0.3s;
            letter-spacing: 0.05em;
        }
        #modeToggle:hover { background: rgba(212,175,55,0.35); transform: scale(1.05); }
        body.light #modeToggle { border-color: #8b6914; color: #5a3e1b; background: rgba(212,175,55,0.2); }
        body.light #modeToggle:hover { background: rgba(212,175,55,0.4); }

        /* ‚îÄ‚îÄ TOP NAV (centered home) ‚îÄ‚îÄ */
        .top-nav {
            text-align: center;
            padding: 18px 20px 8px;
        }


        .main-content { position: relative; z-index: 2; max-width: 1200px; margin: 0 auto; padding: 10px 20px 40px; }
        .header { text-align: center; padding: 40px 20px; border: 3px solid #d4af37; border-radius: 15px; background: rgba(212,175,55,0.05); margin-bottom: 40px; box-shadow: 0 0 40px rgba(212,175,55,0.3); transition: all 0.4s; }
        .header h1 { font-size: 3em; letter-spacing: 0.2em; text-shadow: 0 0 30px rgba(212,175,55,0.8); margin-bottom: 20px; animation: pulse 3s infinite; }
        @keyframes pulse { 0%,100%{text-shadow:0 0 30px rgba(212,175,55,0.8)} 50%{text-shadow:0 0 50px rgba(212,175,55,1)} }
        .header .subtitle { font-size: 1.3em; margin: 10px 0; color: #fff; }
        .header .tagline { font-size: 0.95em; opacity: 0.8; font-style: italic; margin-top: 15px; }
        .stats { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px; margin: 30px 0; padding: 20px; background: rgba(212,175,55,0.1); border: 2px solid #d4af37; border-radius: 10px; transition: all 0.4s; }
        .stat { text-align: center; }
        .stat-value { font-size: 2em; font-weight: bold; color: #d4af37; }
        .stat-label { font-size: 0.9em; opacity: 0.7; margin-top: 5px; }
        .breadcrumb { display: flex; align-items: center; gap: 10px; padding: 15px 20px; background: rgba(212,175,55,0.1); border: 2px solid #d4af37; border-radius: 8px; margin-bottom: 20px; flex-wrap: wrap; overflow-x: auto; transition: all 0.4s; }
        .breadcrumb-item { color: #d4af37; cursor: pointer; padding: 5px 10px; border-radius: 4px; transition: all 0.3s; white-space: nowrap; }
        .breadcrumb-item:hover { background: rgba(212,175,55,0.3); }
        .breadcrumb-separator { color: #666; }
        .file-manager { min-height: 400px; padding: 20px; background: rgba(0,0,0,0.5); border: 2px solid #d4af37; border-radius: 10px; margin-bottom: 60px; transition: all 0.4s; }
        .file-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
        .file-item { background: rgba(212,175,55,0.05); border: 2px solid #d4af37; border-radius: 8px; padding: 15px; text-align: center; cursor: pointer; transition: all 0.3s; position: relative; }
        .file-item:hover { background: rgba(212,175,55,0.15); transform: translateY(-5px); box-shadow: 0 10px 30px rgba(212,175,55,0.4); }
        .file-icon { font-size: 3.5em; margin-bottom: 10px; filter: drop-shadow(0 0 10px rgba(212,175,55,0.5)); }
        .file-name { font-size: 0.85em; word-break: break-word; line-height: 1.3; margin-bottom: 8px; }
        .file-size { font-size: 0.7em; opacity: 0.5; }
        .file-actions { display: flex; gap: 5px; justify-content: center; margin-top: 10px; }
        .action-btn { padding: 5px 10px; background: rgba(212,175,55,0.2); border: 1px solid #d4af37; color: #d4af37; border-radius: 4px; cursor: pointer; font-size: 0.75em; transition: all 0.3s; font-family: 'Courier New', monospace; }
        .action-btn:hover { background: rgba(212,175,55,0.4); transform: scale(1.05); }
        .state-message { text-align: center; padding: 60px 20px; font-size: 1.3em; line-height: 1.8; }
        .state-message code { background: rgba(0,0,0,0.5); padding: 2px 8px; border-radius: 4px; color: #0f0; }
        .loading::after { content: '...'; animation: dots 1.5s infinite; }
        @keyframes dots { 0%,20%{content:'.'} 40%{content:'..'} 60%,100%{content:'...'} }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); z-index: 9999; justify-content: center; align-items: center; padding: 20px; }
        .modal.active { display: flex; }
        .modal-content { max-width: 1200px; width: 100%; background: #111; border: 3px solid #d4af37; border-radius: 10px; padding: 20px; box-shadow: 0 0 60px rgba(212,175,55,0.5); max-height: 90vh; display: flex; flex-direction: column; transition: all 0.4s; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #d4af37; flex-shrink: 0; }
        .modal-title { font-size: 1.3em; max-width: 80%; word-break: break-word; }
        .close-btn { background: none; border: none; color: #d4af37; font-size: 2.5em; cursor: pointer; padding: 0; width: 50px; height: 50px; line-height: 50px; transition: all 0.3s; flex-shrink: 0; }
        .close-btn:hover { transform: rotate(90deg) scale(1.2); text-shadow: 0 0 30px rgba(212,175,55,1); }
        .modal-body-scroll { overflow-y: auto; flex: 1; }
        video, audio, img { width: 100%; max-height: 70vh; border-radius: 8px; background: #000; }
        .preview-text { background: #000; color: #d4af37; padding: 30px 40px; border-radius: 8px; font-family: 'Courier New', monospace; white-space: pre-wrap; word-break: break-word; font-size: 1em; line-height: 1.8; transition: all 0.4s; }
        .download-btn { display: inline-block; margin-top: 15px; padding: 12px 25px; background: rgba(212,175,55,0.2); border: 2px solid #d4af37; color: #d4af37; text-decoration: none; border-radius: 6px; transition: all 0.3s; font-size: 1em; flex-shrink: 0; }
        .download-btn:hover { background: rgba(212,175,55,0.5); transform: scale(1.05); }
        .instructions { margin-top: 60px; padding: 40px; background: rgba(212,175,55,0.05); border: 3px solid #d4af37; border-radius: 15px; box-shadow: 0 0 40px rgba(212,175,55,0.2); transition: all 0.4s; }
        .instructions h2 { font-size: 2.5em; text-align: center; margin-bottom: 30px; color: #d4af37; text-shadow: 0 0 20px rgba(212,175,55,0.5); }
        .instructions h3 { font-size: 1.5em; margin-top: 30px; margin-bottom: 15px; color: #ffd700; }
        .instructions p, .instructions li { line-height: 1.8; margin-bottom: 10px; font-size: 1em; color: #d4af37; }
        .instructions code { background: rgba(0,0,0,0.5); padding: 3px 8px; border-radius: 4px; color: #0f0; font-family: 'Courier New', monospace; font-size: 0.95em; }
        .instructions pre { background: #000; padding: 20px; border-radius: 8px; overflow-x: auto; margin: 15px 0; border: 1px solid #d4af37; }
        .instructions pre code { background: none; padding: 0; display: block; line-height: 1.6; }
        .instructions .highlight { background: rgba(212,175,55,0.2); padding: 25px; border-left: 5px solid #d4af37; margin: 25px 0; border-radius: 4px; }
        .instructions .highlight p { color: #fff; font-size: 1.1em; }
        .instructions ul { margin-left: 30px; }
        .instructions strong { color: #ffd700; }
        .back-home { display: inline-block; padding: 12px 32px; background: none; border: 2px solid rgba(255,255,255,0.4); color: #ffffff; text-decoration: none; border-radius: 6px; transition: all 0.3s; font-family: 'Courier New', monospace; }
        .back-home:hover { background: rgba(255,255,255,0.1); color: #ffd700; border-color: #ffd700; }
        body.light .back-home { color: #5a3e1b; border-color: rgba(90,62,27,0.5); }
        body.light .back-home:hover { background: rgba(90,62,27,0.1); color: #7a5520; border-color: #7a5520; }
        @media(max-width:768px) { .header h1{font-size:2em;letter-spacing:0.1em} .file-grid{grid-template-columns:repeat(auto-fill,minmax(140px,1fr))} .quotes-container{display:none} .stats{font-size:0.9em} .instructions{padding:20px} .instructions h2{font-size:1.8em} .instructions h3{font-size:1.2em} }
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #d4af37; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #ffd700; }
    </style>
</head>
<body>

    <!-- LIGHT/DARK TOGGLE -->
    <button id="modeToggle" onclick="toggleMode()">‚òÄÔ∏è LIGHT</button>

    <div class="main-content">

        <!-- HOME BUTTON ‚Äî TOP CENTRE -->
        <div class="top-nav">
            <a href="https://kkk.education" class="back-home">‚Üê HOME</a>
        </div>

        <div class="header">
            <h1>üíÄ THE TOMB CINEMA üíÄ</h1>
            <div class="subtitle">üé¨ THE COMPLETE ARCHIVE üé¨</div>
            <div class="tagline">
                "Where forbidden knowledge becomes eternal pixels"<br>
                "Decades of work. Zero gatekeepers."
            </div>
        </div>

        <div class="stats" id="stats">
            <div class="stat"><div class="stat-value">üìÅ <span id="folderCount">0</span></div><div class="stat-label">Forbidden Folders</div></div>
            <div class="stat"><div class="stat-value">üé¨ <span id="videoCount">0</span></div><div class="stat-label">Productions</div></div>
            <div class="stat"><div class="stat-value">üì¶ <span id="totalCount">0</span></div><div class="stat-label">Total Files</div></div>
            <div class="stat"><div class="stat-value">üíæ <span id="totalSize">0 GB</span></div><div class="stat-label">Archive Size</div></div>
        </div>

        <div class="breadcrumb" id="breadcrumb">
            <span class="breadcrumb-item" data-path="">üè† Root Tomb</span>
        </div>

        <div class="file-manager">
            <div class="file-grid" id="fileGrid">
                <div class="state-message loading">üîÆ Summoning archive from the void</div>
            </div>
        </div>

        <!-- INSTRUCTIONS -->
        <div class="instructions">
            <h2>üëë THIS IS YOURS NOW üëë</h2>
            <div class="highlight">
                <p><strong>üåà FOR THE KIDS. FOR THE EXILES. üåà</strong></p>
                <p>Take this. Fork it. Make your own cinema. No permission needed. No gatekeepers. No waiting for approval.</p>
                <p><strong>If they said you can't publish, build your own platform.</strong></p>
                <p>This is how you do it.</p>
            </div>
            <h3>üì¶ What You Need</h3>
            <ul>
                <li><strong>This file</strong> (<code>cinema.html</code>) ‚Äî The page you're looking at</li>
                <li><strong><a href="generate-manifest.js" download>generate-manifest.js</a></strong> ‚Äî Node.js script to scan your videos</li>
                <li><strong>Node.js</strong> ‚Äî Free download from <code>nodejs.org</code></li>
                <li><strong>Your content</strong> ‚Äî Videos, images, files you want to share</li>
            </ul>
            <h3>üöÄ How To Use This (3 Steps)</h3>
            <p><strong>STEP 1: Get the script</strong></p>
            <p><a href="generate-manifest.js" download style="font-weight:bold;">‚¨á Download generate-manifest.js</a> ‚Äî it's in the root directory alongside this page.</p>
            <p>Put it in the same folder as <code>cinema.html</code>.</p>
            <p><strong>STEP 2: Configure it (ONE LINE TO CHANGE)</strong></p>
            <p>Open <code>generate-manifest.js</code> in any text editor. Find line 12. Change it to point to your videos:</p>
            <pre><code>// Line 12 - CHANGE THIS:
const ARCHIVE_DIR = '/path/to/your/videos';

// Examples:
// Mac:     const ARCHIVE_DIR = '/Users/yourname/Videos';
// Windows: const ARCHIVE_DIR = 'C:\\Users\\YourName\\Videos';
// Server:  const ARCHIVE_DIR = '/var/www/html/videos';
// Local:   const ARCHIVE_DIR = './my-videos';</code></pre>
            <p><strong>STEP 3: Run it</strong></p>
            <pre><code>cd /path/to/your/cinema/folder
node generate-manifest.js</code></pre>
            <p>This creates <code>manifest.json</code>. Open <code>cinema.html</code> in your browser. Your cinema is live.</p>
            <h3>üåê Put It Online</h3>
            <ul>
                <li><code>cinema.html</code> (this page)</li>
                <li><code>manifest.json</code> (generated by the script)</li>
                <li>Your video/file folder (make sure it's web-accessible)</li>
            </ul>
            <div class="highlight">
                <p><strong>üí° IMPORTANT: WEB_PREFIX</strong></p>
                <p>In <code>generate-manifest.js</code>, there's a line: <code>const WEB_PREFIX = '/videos';</code></p>
                <p>This tells the script how browsers will access your files. Match it to your URL structure.</p>
            </div>
            <h3>üé¨ What This Does</h3>
            <ul>
                <li>‚úÖ Streams videos in browser (mp4, webm, ogv, avi, mov, mkv)</li>
                <li>‚úÖ Plays audio files (mp3, wav, ogg, flac)</li>
                <li>‚úÖ Previews images (jpg, png, gif, svg)</li>
                <li>‚úÖ Shows <strong>complete text files</strong> (txt, md, html, css, js, log) ‚Äî full content, no truncation</li>
                <li>‚úÖ Downloads everything else</li>
                <li>‚úÖ Browse folders like a file manager</li>
                <li>‚úÖ No database. No PHP. Just HTML + JSON.</li>
            </ul>
            <div class="highlight" style="text-align:center;margin-top:40px;">
                <p style="font-size:1.3em;"><strong>üåà Warriors of the Rainbow protect the children üåà</strong></p>
                <p style="margin-top:20px;font-size:1.2em;"><strong>üíÄ THE TOMB NEVER CLOSES üíÄ</strong></p>
                <p style="margin-top:15px;">"Where tears become pixels"</p>
            </div>
            <h3>üìú License</h3>
            <p><strong>CC0 PUBLIC DOMAIN ‚Äî ALL LOVE RESERVED</strong></p>
            <p>Built by WIKKKAN in psychiatric detention, February 2026.<br>For every kid who was told "you can't." For every exile who needs a voice.</p>
        </div>

        <!-- SAVE THIS CINEMA -->
        <div style="text-align:center;margin-top:50px;padding:30px;border:2px solid rgba(212,175,55,0.4);border-radius:10px;background:rgba(212,175,55,0.05);box-shadow:0 0 30px rgba(212,175,55,0.1);">
            <div style="font-family:'Courier New',monospace;font-size:1em;letter-spacing:0.2em;color:#ffd700;margin-bottom:12px;">üì¶ SAVE THIS CINEMA</div>
            <p style="font-size:0.95em;color:#b8860b;margin-bottom:18px;line-height:1.7;">Save this page and open it anywhere.<br>It will always stream content from the live server ‚Äî works online or offline.</p>
            <button onclick="window.open('https://kkk.education/cinema.html','_blank')" style="padding:10px 24px;background:rgba(212,175,55,0.1);border:2px solid #d4af37;color:#d4af37;font-family:'Courier New',monospace;font-size:0.85em;cursor:pointer;margin:5px;border-radius:6px;">üåê OPEN LIVE VERSION</button>
            <button onclick="saveThisPage()" style="padding:10px 24px;background:rgba(212,175,55,0.1);border:2px solid #d4af37;color:#d4af37;font-family:'Courier New',monospace;font-size:0.85em;cursor:pointer;margin:5px;border-radius:6px;">üíæ SAVE THIS FILE</button>
            <p id="saveStatus" style="margin-top:14px;font-size:0.85em;color:#b8860b;min-height:18px;"></p>
        </div>

    </div>

    <!-- Player Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle"></div>
                <button class="close-btn" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body-scroll" id="modalBody"></div>
            <a href="#" class="download-btn" id="downloadLink" download>‚¨á Download This File</a>
        </div>
    </div>

    <script>
        /* ‚îÄ‚îÄ LIGHT / DARK MODE ‚îÄ‚îÄ */
        const savedMode = localStorage.getItem('cinemaMode') || 'dark';
        if (savedMode === 'light') applyLight();

        function applyLight() {
            document.body.classList.add('light');
            document.getElementById('modeToggle').textContent = 'üåô DARK';
        }
        function applyDark() {
            document.body.classList.remove('light');
            document.getElementById('modeToggle').textContent = '‚òÄÔ∏è LIGHT';
        }
        function toggleMode() {
            if (document.body.classList.contains('light')) {
                applyDark();
                localStorage.setItem('cinemaMode', 'dark');
            } else {
                applyLight();
                localStorage.setItem('cinemaMode', 'light');
            }
        }

        /* ‚îÄ‚îÄ CINEMA CORE ‚îÄ‚îÄ */
        const CONFIG = {
            manifestPath: 'manifest.json',
            icons: { folder:'üìÅ', video:'üé¨', image:'üñºÔ∏è', audio:'üéµ', text:'üìÑ', pdf:'üìï', archive:'üì¶', code:'üíª', unknown:'üëª' },
            videoExts:   ['mp4','mpeg4','ogv','webm','avi','mov','mkv','m4v'],
            imageExts:   ['jpg','jpeg','png','gif','webp','svg','bmp','ico'],
            audioExts:   ['mp3','wav','ogg','flac','m4a','aac'],
            textExts:    ['txt','md','log','html','css','js','json','xml','csv'],
            pdfExts:     ['pdf'],
            archiveExts: ['zip','rar','7z','tar','gz'],
            codeExts:    ['py','php','sh','c','cpp','java','go','rs']
        };

        let manifestData = null;
        let currentPath  = '';

        document.addEventListener('DOMContentLoaded', async () => {
            await loadManifest();
            if (manifestData) navigateTo('');
        });

        async function loadManifest() {
            if (window.EMBEDDED_MANIFEST) {
                manifestData = window.EMBEDDED_MANIFEST;
                updateGlobalStats();
                return;
            }
            try {
                const response = await fetch(CONFIG.manifestPath);
                if (!response.ok) throw new Error('Manifest not found');
                manifestData = await response.json();
                updateGlobalStats();
            } catch (error) {
                showError('üëª <strong>Manifest not found!</strong><br><br>Run <code>node generate-manifest.js</code> first.<br><br><small>Scroll down for full instructions.</small>');
            }
        }

        function navigateTo(path) {
            currentPath = path;
            updateBreadcrumb(path);
            renderFiles(path);
        }

        function renderFiles(path) {
            const grid  = document.getElementById('fileGrid');
            const items = getItemsAtPath(path);
            if (!items || items.length === 0) {
                grid.innerHTML = '<div class="state-message">üìÇ Empty tomb.<br>Nothing here... yet. üíÄ</div>';
                return;
            }
            grid.innerHTML = '';
            items.sort((a,b) => {
                if (a.type==='folder' && b.type!=='folder') return -1;
                if (a.type!=='folder' && b.type==='folder') return 1;
                return a.name.localeCompare(b.name);
            });
            items.forEach(item => grid.appendChild(createFileElement(item)));
        }

        function getItemsAtPath(path) {
            if (!manifestData) return [];
            if (!path) return manifestData.items || [];
            const parts = path.split('/');
            let current = manifestData.items || [];
            for (const part of parts) {
                const folder = current.find(i => i.type==='folder' && i.name===part);
                if (!folder || !folder.children) return [];
                current = folder.children;
            }
            return current;
        }

        function createFileElement(item) {
            const div = document.createElement('div');
            div.className = 'file-item';
            const icon = getIcon(item);
            const size = item.size ? formatSize(item.size) : '';
            let actionsHTML = '';
            if (item.type !== 'folder') {
                const ext = getExtension(item.name);
                if (CONFIG.videoExts.includes(ext) || CONFIG.audioExts.includes(ext)) {
                    actionsHTML = `<div class="file-actions">
                        <button class="action-btn" onclick="event.stopPropagation();streamFile('${escapeHtml(item.path)}','${escapeHtml(item.name)}')">‚ñ∂ Stream</button>
                        <button class="action-btn" onclick="event.stopPropagation();downloadFile('${escapeHtml(item.path)}','${escapeHtml(item.name)}')">‚¨á Get</button>
                    </div>`;
                } else {
                    actionsHTML = `<div class="file-actions">
                        <button class="action-btn" onclick="event.stopPropagation();downloadFile('${escapeHtml(item.path)}','${escapeHtml(item.name)}')">‚¨á Download</button>
                    </div>`;
                }
            }
            div.innerHTML = `
                <div class="file-icon">${icon}</div>
                <div class="file-name">${escapeHtml(item.name)}</div>
                ${size ? `<div class="file-size">${size}</div>` : ''}
                ${actionsHTML}
            `;
            if (item.type === 'folder') {
                div.onclick = () => navigateTo(currentPath ? `${currentPath}/${item.name}` : item.name);
            } else {
                div.onclick = () => handleFile(item);
            }
            return div;
        }

        function handleFile(file) {
            const ext = getExtension(file.name);
            if (CONFIG.videoExts.includes(ext) || CONFIG.audioExts.includes(ext)) streamFile(file.path, file.name);
            else if (CONFIG.imageExts.includes(ext)) previewImage(file.path, file.name);
            else if (CONFIG.textExts.includes(ext)) previewText(file.path, file.name);
            else downloadFile(file.path, file.name);
        }

        function streamFile(path, name) {
            const ext     = getExtension(name);
            const isVideo = CONFIG.videoExts.includes(ext);
            const tag     = isVideo ? 'video' : 'audio';
            showModal(name, `<${tag} controls autoplay><source src="${path}" type="${isVideo?'video':'audio'}/${ext}">Your browser doesn't support this format. üëª</${tag}>`, path, name);
        }

        function previewImage(path, name) {
            showModal(name, `<img src="${path}" alt="${escapeHtml(name)}" style="object-fit:contain;">`, path, name);
        }

        async function previewText(path, name) {
            try {
                const response = await fetch(path);
                const text     = await response.text();
                showModal(name, `<div class="preview-text">${escapeHtml(text)}</div>`, path, name);
            } catch(e) {
                showModal(name, `<div class="state-message">‚ùå Can't preview this file<br><small>Download it instead</small></div>`, path, name);
            }
        }

        function downloadFile(path, name) {
            const a = document.createElement('a');
            a.href = path; a.download = name;
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
        }

        function showModal(title, bodyHTML, downloadPath, downloadName) {
            document.getElementById('modalTitle').textContent   = title;
            document.getElementById('modalBody').innerHTML      = bodyHTML;
            document.getElementById('downloadLink').href        = downloadPath;
            document.getElementById('downloadLink').download    = downloadName;
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            const modalBody = document.getElementById('modalBody');
            const media     = modalBody.querySelector('video, audio');
            if (media) { media.pause(); media.src = ''; }
            document.getElementById('modal').classList.remove('active');
        }

        function updateBreadcrumb(path) {
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.innerHTML = '';
            const root = document.createElement('span');
            root.className = 'breadcrumb-item';
            root.textContent = 'üè† Root Tomb';
            root.onclick = () => navigateTo('');
            breadcrumb.appendChild(root);
            if (path) {
                const segments = path.split('/');
                let buildPath  = '';
                segments.forEach(segment => {
                    const sep = document.createElement('span');
                    sep.className = 'breadcrumb-separator';
                    sep.textContent = '‚Ä∫';
                    breadcrumb.appendChild(sep);
                    buildPath += (buildPath ? '/' : '') + segment;
                    const item = document.createElement('span');
                    item.className = 'breadcrumb-item';
                    item.textContent = segment;
                    const p = buildPath;
                    item.onclick = () => navigateTo(p);
                    breadcrumb.appendChild(item);
                });
            }
        }

        function updateGlobalStats() {
            if (!manifestData) return;
            const stats = manifestData.stats || {};
            document.getElementById('folderCount').textContent = stats.folders    || 0;
            document.getElementById('videoCount').textContent  = stats.productions || 0;
            document.getElementById('totalCount').textContent  = stats.total      || 0;
            document.getElementById('totalSize').textContent   = formatSize(stats.totalSize || 0);
        }

        function getIcon(item) {
            if (item.type === 'folder') return CONFIG.icons.folder;
            const ext = getExtension(item.name);
            if (CONFIG.videoExts.includes(ext))   return CONFIG.icons.video;
            if (CONFIG.imageExts.includes(ext))   return CONFIG.icons.image;
            if (CONFIG.audioExts.includes(ext))   return CONFIG.icons.audio;
            if (CONFIG.textExts.includes(ext))    return CONFIG.icons.text;
            if (CONFIG.pdfExts.includes(ext))     return CONFIG.icons.pdf;
            if (CONFIG.archiveExts.includes(ext)) return CONFIG.icons.archive;
            if (CONFIG.codeExts.includes(ext))    return CONFIG.icons.code;
            return CONFIG.icons.unknown;
        }

        function getExtension(filename) { return filename.split('.').pop().toLowerCase(); }

        function formatSize(bytes) {
            if (!bytes) return '0 B';
            const sizes = ['B','KB','MB','GB','TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showError(html) {
            document.getElementById('fileGrid').innerHTML = `<div class="state-message">${html}</div>`;
        }

        async function saveThisPage() {
            const status = document.getElementById('saveStatus');
            status.textContent = '‚è≥ Fetching page and manifest...';
            try {
                const [pageRes, manifestRes] = await Promise.all([
                    fetch('https://kkk.education/cinema.html'),
                    fetch('https://kkk.education/manifest.json')
                ]);
                var pageText     = await pageRes.text();
                var manifestText = await manifestRes.text();
                var injection    = '<scr' + 'ipt>window.EMBEDDED_MANIFEST=' + manifestText + ';</scr' + 'ipt>';
                pageText = pageText.replace('</head>', injection + '</head>');
                var blob = new Blob([pageText], {type: 'text/html'});
                var a    = document.createElement('a');
                a.href   = URL.createObjectURL(blob);
                a.download = 'cinema.html';
                document.body.appendChild(a); a.click(); document.body.removeChild(a);
                URL.revokeObjectURL(a.href);
                status.textContent = '‚úÖ Saved! Open cinema.html anywhere ‚Äî streams content from live server.';
            } catch(e) {
                status.textContent = '‚ùå ' + e.message + ' ‚Äî try File > Save Page As instead.';
            }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });
        document.getElementById('modal').addEventListener('click', (e) => { if (e.target.id === 'modal') closeModal(); });
    </script>
</body>
</html>